/* EchoNote 样式 - refactored glassmorphism tokens */
@import "tailwindcss";

/* Theme tokens */
:root {
    --color-primary: #007aff;
    --color-primary-hover: rgba(0, 122, 255, 0.1);
    --color-primary-light: rgba(0, 122, 255, 0.05);

    --color-success: #34c759;
    --color-success-light: rgba(52, 199, 89, 0.1);

    --color-text-primary: #1d1d1f;
    --color-text-secondary: #86868b;
    --color-text-tertiary: rgba(134, 134, 139, 0.4);
    --color-text-inverse: #ffffff;

    --color-bg-primary: #ffffff;
    --color-bg-secondary: rgba(255, 255, 255, 0.85);
    --color-bg-tertiary: rgba(255, 255, 255, 0.6);
    --color-bg-hover: rgba(0, 0, 0, 0.05);

    --color-border-primary: rgba(0, 0, 0, 0.05);
    --color-border-secondary: rgba(0, 0, 0, 0.1);

    --page-gradient: radial-gradient(circle at 10% 20%, rgba(0, 122, 255, 0.08), transparent 50%),
        linear-gradient(180deg, #f4f6fb, #fdfdfd);
    --layout-gradient: radial-gradient(circle at 10% 20%, rgba(0, 122, 255, 0.08), transparent 40%),
        radial-gradient(circle at 80% 0%, rgba(52, 199, 89, 0.08), transparent 45%);

    --panel-bg: var(--color-bg-secondary);
    --panel-shadow: 0 20px 70px rgba(15, 23, 42, 0.18);
    --panel-radius: 1.75rem;
    --panel-blur: 16px;
    --hero-reserved-space: clamp(13rem, 22vh, 16rem);

    --card-shadow: 0 20px 45px rgba(15, 23, 42, 0.08);
    --card-border: rgba(255, 255, 255, 0.35);
    --timeline-card-bg: radial-gradient(circle at 10% 20%, rgba(0, 122, 255, 0.08), transparent 60%),
        rgba(255, 255, 255, 0.9);
    --timeline-placeholder-bg: rgba(255, 255, 255, 0.6);

    --focus-ring-color: var(--color-primary);
}

[data-theme="dark"] {
    --color-primary: #0a84ff;
    --color-primary-hover: rgba(10, 132, 255, 0.2);
    --color-primary-light: rgba(10, 132, 255, 0.1);

    --color-success: #30d158;
    --color-success-light: rgba(48, 209, 88, 0.2);

    --color-text-primary: #f5f5f7;
    --color-text-secondary: #98989d;
    --color-text-tertiary: rgba(152, 152, 157, 0.4);
    --color-text-inverse: #1d1d1f;

    --color-bg-primary: #1c1c1e;
    --color-bg-secondary: rgba(28, 28, 30, 0.9);
    --color-bg-tertiary: rgba(28, 28, 30, 0.85);
    --color-bg-hover: rgba(255, 255, 255, 0.1);

    --color-border-primary: rgba(255, 255, 255, 0.1);
    --color-border-secondary: rgba(255, 255, 255, 0.15);

    --page-gradient: radial-gradient(circle at 10% 20%, rgba(10, 132, 255, 0.12), transparent 50%),
        #0d0f16;
    --layout-gradient: radial-gradient(circle at 15% 25%, rgba(10, 132, 255, 0.12), transparent 45%),
        radial-gradient(circle at 80% 0%, rgba(48, 209, 88, 0.08), transparent 50%),
        linear-gradient(180deg, #05060a, #0f1017);

    --panel-shadow: 0 25px 65px rgba(0, 0, 0, 0.5);
    --card-shadow: 0 25px 60px rgba(0, 0, 0, 0.45);
    --card-border: rgba(255, 255, 255, 0.08);
    --timeline-card-bg: rgba(30, 30, 34, 0.9);
    --timeline-placeholder-bg: rgba(30, 30, 34, 0.75);
}

@layer base {

    *,
    *::before,
    *::after {
        box-sizing: border-box;
    }

    body {
        margin: 0;
        font-family:
            -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC",
            "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
        color: var(--color-text-primary);
        min-height: 100vh;
        background: var(--page-gradient);
    }

    :focus-visible {
        outline: 2px solid var(--focus-ring-color);
        outline-offset: 2px;
    }

    * {
        scrollbar-width: none;
        -ms-overflow-style: none;
    }

    *::-webkit-scrollbar {
        width: 0;
        height: 0;
    }
}

@layer components {

    /* Shared surfaces */
    .surface-card {
        border: 1px solid var(--color-border-primary);
        border-radius: var(--panel-radius);
        background: var(--panel-bg);
        box-shadow: var(--panel-shadow);
        backdrop-filter: blur(var(--panel-blur));
    }

    .surface-card--plain {
        background: var(--color-bg-primary);
    }

    .surface-card--tight {
        border-radius: 1.25rem;
    }

    .surface-card--flat {
        box-shadow: none;
    }

    .timeline-card {
        border: 1px solid var(--card-border);
        border-radius: 1.5rem;
        background: var(--timeline-card-bg);
        box-shadow:
            var(--card-shadow),
            inset 0 1px 0 rgba(255, 255, 255, 0.35);
        backdrop-filter: blur(16px);
    }

    .pill-button {
        @apply inline-flex items-center justify-center gap-2 font-semibold rounded-full transition-colors disabled:opacity-60 disabled:cursor-not-allowed;
        padding: 0.5rem 1.5rem;
        border: 1px solid transparent;
        background: transparent;
        cursor: pointer;
        text-decoration: none;
    }

    .pill-button--compact {
        padding: 0.35rem 1rem;
        font-size: 0.9rem;
        gap: 0.35rem;
    }

    .pill-button--ghost {
        border-color: var(--color-border-primary);
        color: var(--color-text-primary);
        background: var(--color-bg-primary);
    }

    .pill-button--minimal {
        border-color: transparent;
        color: var(--color-primary);
    }

    .pill-button--ghost:hover,
    .pill-button--minimal:hover,
    .icon-button:hover {
        background: var(--color-primary-hover);
    }

    .pill-button--primary {
        color: var(--color-text-inverse);
        background: var(--color-primary);
        border-color: transparent;
    }

    .icon-button {
        @apply w-8 h-8 inline-flex items-center justify-center rounded-full transition-colors;
        color: var(--color-primary);
        border: none;
        background: transparent;
        cursor: pointer;
    }

    .badge {
        @apply inline-flex items-center gap-2 text-xs px-3 py-1 rounded-full border;
        border-color: var(--color-border-primary);
        color: var(--color-text-secondary);
        background: color-mix(in srgb, var(--color-bg-tertiary) 90%, transparent);
    }

    .section-header {
        @apply text-base font-semibold tracking-tight;
        color: var(--color-text-primary);
    }

    .muted-text {
        color: var(--color-text-secondary);
    }

    .layout-shell {
        @apply min-h-screen flex flex-col;
        background: var(--layout-gradient);
    }

    .layout-shell__main {
        @apply flex-1 flex flex-col overflow-hidden min-h-0;
        padding: clamp(1.5rem, 4vw, 3.5rem);
        min-height: 100vh;
    }

    @supports (min-height: 100dvh) {
        .layout-shell__main {
            min-height: 100dvh;
        }
    }

    .home {
        @apply flex flex-col gap-6 w-full max-w-[90rem] mx-auto flex-1 h-full min-h-0 overflow-hidden;
        height: 100%;
    }

    .home--portrait {
        @apply h-full overflow-hidden;
    }

    .home__layout {
        @apply flex gap-6 items-stretch min-h-0 flex-1 h-full overflow-hidden;
        height: calc(100vh - var(--hero-reserved-space));
        max-height: 100%;
    }

    @supports (height: 100dvh) {
        .home__layout {
            height: calc(100dvh - var(--hero-reserved-space));
        }
    }

    .home--portrait .home__layout {
        @apply flex-col gap-4;
        min-height: 0;
    }

    .home__sidebar,
    .home__timeline {
        @apply p-5 w-full;
    }

    .home__timeline {
        @apply flex flex-col gap-4 min-h-0 h-full max-h-full overflow-hidden flex-1;
        min-height: 0;
        height: 100%;
        max-height: 100%;
    }

    .home--landscape .home__sidebar {
        flex: 0 0 clamp(280px, 30vw, 400px);
    }

    .home--landscape .home__timeline {
        min-width: 0;
    }

    .home__sidebar {
        @apply flex flex-col min-h-0 self-start;
        flex: 0 0 320px;
    }

    .home--portrait .home__sidebar {
        @apply flex-none w-full;
        max-height: min(45vh, 28rem);
        overflow: auto;
    }

    .home--portrait .home__timeline {
        @apply flex-1 min-h-0 overflow-hidden;
        max-height: 100%;
    }

    .home__timeline-actions {
        @apply flex justify-end flex-shrink-0;
    }

    .home__sidebar :global(.calendar) {
        @apply rounded-2xl overflow-auto;
        max-height: calc(100vh - var(--hero-reserved-space));
    }

    @supports (height: 100dvh) {
        .home__sidebar :global(.calendar) {
            max-height: calc(100dvh - var(--hero-reserved-space));
        }
    }

    .home__timeline :global(.timeline) {
        @apply h-full min-h-0;
        max-height: 100%;
    }

    .settings {
        @apply py-4 w-full max-w-[90rem] mx-auto flex-1 overflow-y-auto flex;
        min-height: calc(100vh - 5rem);
    }

    .settings__panel {
        @apply w-full p-8;
    }

    .settings__panel header h1 {
        @apply mb-2;
    }

    .settings__panel header p {
        @apply mb-6;
        color: var(--color-text-secondary);
    }

    .settings__back {
        @apply inline-flex items-center gap-1 text-sm font-semibold no-underline;
        color: var(--color-primary);
    }

    .settings__back:hover {
        @apply underline;
    }

    .settings__grid {
        @apply grid gap-5;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }

    .settings__grid article {
        @apply p-5 flex flex-col gap-3;
    }

    .settings__choices {
        @apply flex flex-wrap gap-2;
    }

    .settings__grid article h2 {
        @apply text-base;
    }

    .settings__grid article p {
        @apply text-sm;
        color: var(--color-text-secondary);
    }

    .editor-shell {
        @apply flex flex-col w-full max-w-[80rem] mx-auto flex-1 gap-4 overflow-y-auto;
        min-height: calc(100vh - 5rem);
        padding: clamp(1rem, 3vw, 2.25rem);
    }

    .editor-shell__toolbar {
        @apply flex items-center gap-4 flex-wrap;
    }

    .editor-shell__date {
        @apply font-semibold flex-1 flex items-center gap-2 min-w-0 text-base;
        color: var(--color-text-primary);
    }

    .editor-shell__weekday {
        @apply text-sm;
        color: var(--color-text-secondary);
    }

    .editor-shell__dot {
        @apply w-2 h-2 rounded-full;
        background: var(--color-success);
        box-shadow: 0 0 10px rgba(52, 199, 89, 0.6);
    }

    .editor-shell__body {
        @apply flex-1 flex;
    }

    .editor-shell__textarea {
        @apply w-full h-full border-none outline-none bg-transparent p-4 resize-none text-base leading-relaxed;
        color: var(--color-text-primary);
    }

    .calendar {
        @apply flex flex-col gap-4 min-h-0 h-full overflow-auto;
    }

    .calendar-section {
        @apply overflow-hidden;
        transition:
            max-height 0.3s ease,
            opacity 0.25s ease;
    }

    .calendar--static .calendar-section {
        transition: none;
    }

    .calendar-section--collapsed {
        max-height: 0;
        opacity: 0;
    }

    .calendar-section--expanded {
        max-height: 30rem;
        opacity: 1;
    }

    .entry-dot {
        @apply absolute bottom-1 w-1 h-1 rounded-full;
        left: 50%;
        transform: translateX(-50%);
        background: var(--color-success);
    }

    .calendar button {
        background: transparent;
    }

    .calendar button:focus-visible {
        @apply outline outline-2 outline-offset-2;
        outline-color: var(--color-primary);
    }

    .date-cell {
        @apply w-12 h-12 mx-auto rounded-full border relative flex flex-col items-center justify-center transition-all duration-200 select-none;
        border-color: color-mix(in srgb, var(--color-border-primary) 80%, transparent);
        box-shadow: 0 10px 18px rgba(15, 23, 42, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.5);
        background:
            radial-gradient(circle at top, color-mix(in srgb, var(--color-primary) 12%, transparent), transparent 70%),
            rgba(255, 255, 255, 0.35);
        color: var(--color-text-primary);
    }

    [data-theme="dark"] .date-cell {
        background: rgba(30, 30, 34, 0.7);
        border-color: rgba(255, 255, 255, 0.08);
    }

    .calendar-cell--muted {
        color: var(--color-text-tertiary);
    }

    .calendar-cell--selected {
        background: var(--color-primary);
        color: var(--color-text-inverse);
        box-shadow: 0 18px 32px rgba(0, 122, 255, 0.35);
        outline: 2px solid rgba(255, 255, 255, 0.7);
        outline-offset: 2px;
    }

    .calendar-cell--today {
        background: var(--color-primary-light);
        color: var(--color-text-primary);
        font-weight: 600;
        outline: 1px solid var(--color-primary);
        outline-offset: 1px;
    }

    .calendar-cell--has-entry {
        background: var(--color-success-light);
    }

    .timeline {
        @apply flex flex-col gap-5 h-full min-h-0;
    }

    .timeline__empty {
        @apply m-auto p-8;
        color: var(--color-text-secondary);
    }

    .timeline__list {
        @apply list-none p-0 m-0 flex flex-col gap-7 pr-2 overflow-y-auto flex-1 min-h-0;
        padding-top: clamp(1rem, 2vw, 1.5rem);
        padding-left: clamp(1rem, 2vw, 1.5rem);
    }

    .timeline__item {
        @apply grid items-center gap-5;
        grid-template-columns: 150px minmax(0, 1fr);
        scroll-margin-top: 2.5rem;
    }

    .timeline__axis {
        @apply relative flex flex-col gap-1 text-sm pl-6;
        color: var(--color-text-secondary);
    }

    .timeline__axis::after {
        content: "";
        position: absolute;
        top: 0.85rem;
        left: 0;
        right: -1.25rem;
        height: 2px;
        background: linear-gradient(90deg, rgba(0, 0, 0, 0.05), rgba(0, 122, 255, 0.4));
    }

    .timeline__dot {
        @apply absolute top-[0.45rem] left-0 w-3 h-3 rounded-full border-2;
        border-color: var(--color-primary);
        box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.12);
        background: #fff;
    }

    .timeline__card {
        @apply w-full p-5 text-left cursor-pointer transition;
    }

    .timeline__card:hover {
        @apply -translate-y-1;
        box-shadow: 0 25px 60px rgba(15, 23, 42, 0.16);
    }

    .timeline__card--active {
        @apply -translate-y-0.5;
        border-color: var(--color-primary);
        box-shadow: 0 25px 60px rgba(15, 23, 42, 0.2);
    }

    .timeline__card--placeholder {
        @apply border-dashed min-h-[150px] flex items-center justify-center text-center;
        border-color: var(--color-border-secondary);
        background: var(--timeline-placeholder-bg);
    }

    .timeline__item--active .timeline__axis {
        color: var(--color-text-primary);
    }

    .timeline__dot--active {
        background: var(--color-primary);
        box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.2);
    }

    .timeline__card-title {
        @apply flex items-center justify-between gap-3 mb-3 font-semibold;
    }

    .timeline__mood {
        @apply text-2xl;
    }

    .timeline__preview {
        @apply text-sm leading-relaxed opacity-80;
        color: var(--color-text-primary);
    }

    .timeline__summary {
        @apply mt-3 text-xs inline-flex items-center gap-1.5 px-3 py-2 rounded-lg;
        background: rgba(0, 122, 255, 0.08);
        border: 1px solid rgba(0, 122, 255, 0.12);
        color: var(--color-text-primary);
    }

    .timeline__placeholder {
        @apply flex flex-col gap-1 text-center items-center;
        color: var(--color-text-secondary);
    }
}
